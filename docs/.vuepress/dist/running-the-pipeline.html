<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Running the Pipeline</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.d4613532.css" as="style"><link rel="preload" href="/assets/js/app.98741281.js" as="script"><link rel="preload" href="/assets/js/2.e10afc37.js" as="script"><link rel="preload" href="/assets/js/16.8466b006.js" as="script"><link rel="prefetch" href="/assets/js/10.47a85e35.js"><link rel="prefetch" href="/assets/js/11.e78ae733.js"><link rel="prefetch" href="/assets/js/12.569b3204.js"><link rel="prefetch" href="/assets/js/13.4943b92b.js"><link rel="prefetch" href="/assets/js/14.c1aef2a4.js"><link rel="prefetch" href="/assets/js/15.88b928ad.js"><link rel="prefetch" href="/assets/js/17.48c6fe4c.js"><link rel="prefetch" href="/assets/js/18.38a33712.js"><link rel="prefetch" href="/assets/js/19.b6fe101c.js"><link rel="prefetch" href="/assets/js/20.63f9a4f8.js"><link rel="prefetch" href="/assets/js/21.05021021.js"><link rel="prefetch" href="/assets/js/3.cd2560e0.js"><link rel="prefetch" href="/assets/js/4.1367f42d.js"><link rel="prefetch" href="/assets/js/5.70f8d865.js"><link rel="prefetch" href="/assets/js/6.a2a4a4fd.js"><link rel="prefetch" href="/assets/js/7.22b6c02c.js"><link rel="prefetch" href="/assets/js/8.d5159c77.js"><link rel="prefetch" href="/assets/js/9.40da1173.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4613532.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="running-the-pipeline"><a href="#running-the-pipeline" aria-hidden="true" class="header-anchor">#</a> Running the Pipeline</h1> <h2 id="overview"><a href="#overview" aria-hidden="true" class="header-anchor">#</a> Overview</h2> <p>This page provides instructions on how to run the pipeline through the <code>pipeline.nf</code> script. The basic command below shows how to run Vaporware, with an explanation of flags and input arguments and files. Below is also described how to best <a href="/run-pipeline.html#running-the-pipeline-on-juno">run the pipeline on Juno</a> as well as <a href="/run-pipeline.html#running-the-pipeline-on-aws">on AWS</a>.</p> <div class="language-shell extra-class"><pre class="language-text"><code>nextflow run pipeline.nf \
    --somatic --germline \
    --assayType &lt;string value: either &quot;exome&quot; or &quot;genome&quot;&gt; \
    --outDir &lt;path to output subdirectory&gt; \ 
    -profile juno \
    --mapping &lt;input mapping tsv file&gt; \
    --pairing &lt;input pairing tsv file&gt;
</code></pre></div><p><em>Note: <a href="/nextflow-basics.html">The number of dashes matters</a>.</em></p> <p><strong>Recommended arguments:</strong></p> <ul><li>The <code>--somatic</code> and <code>--germline</code> flags are boolean that indicate to run the somatic and germline variant calling modules, respectively. If not set, the pipeline will only align BAMs.</li> <li><code>--assayType</code> ensures appropriate resources are allocated for indicated assay type.</li> <li><code>--outDir</code> is the directory where the output will end up. This directory does not need to exist. If not set, by default it will be set to run directory (i.e. the directory from which the command <code>nextflow run</code> is executed.)</li> <li><code>-profile</code> loads the preset configuration required to run the pipeline in the supported environment. Accepted values are <code>juno</code> and <code>awsbatch</code> for execution on the <a href="/juno-setup.html">Juno cluster</a> or on <a href="/aws-setup.html">AWS Batch</a>, respectively.</li> <li>The files provided to the <code>--mapping</code> and <code>--pairing</code> arguments should contain the mapping of FASTQ files to sample names and of tumor-normal pairs. These are tab-separated files, see further description below and examples in the <a href="../test_inputs">test inputs subdirectory</a>.</li></ul> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>The <code>assayType</code> argument is for resource allocation. This should also be specified in <a href="/running-the-pipeline.html#the-mapping-file">the mapping file</a>, but for the purpose of correct reference file usage.</p></div> <p><strong>Optional arguments:</strong></p> <ul><li><code>-work-dir</code>/<code>-w</code> is the directory where the temporary output will be cached. By default, this is set to the run directory. Please see <code>NXF_WORK</code> in <a href="https://www.nextflow.io/docs/latest/config.html#environment-variables" target="_blank" rel="noopener noreferrer">Nextflow environment variables<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li> <li><code>-publishAll</code> is a boolean, resulting in retention of intermediate output files.</li> <li><code>-with-timeline</code> and <code>-with-report</code> are enabled by default and results in the generation of a timeline and resource usage report for the pipeline run. These are boolean but can also be fed output names for the respective file.</li></ul> <p>Using test inputs provided in the GitHub repository, here is a concrete example:</p> <div class="language-shell extra-class"><pre class="language-text"><code>nextflow run pipeline.nf --somatic --germline \
    --mapping test_inputs/local/full_test_mapping.tsv \ 
    --pairing test_inputs/local/full_test_pairing.tsv \
    -profile juno \
    --outDir results
</code></pre></div><h2 id="input-files"><a href="#input-files" aria-hidden="true" class="header-anchor">#</a> Input Files</h2> <p>For processing paired-end FASTQ inputs, users must provide both a mapping file and pairing file, as described below.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>The header lines are mandatory in the following files, but not the order of their columns.</p></div> <div class="warning custom-block"><p class="custom-block-title">Be aware</p> <p>Vaporware checks for duplicated combinations of sample and lane names, empty entries, and some other things. However, it is up to the user to make sure that the inputs are in good shape.</p></div> <h3 id="the-mapping-file"><a href="#the-mapping-file" aria-hidden="true" class="header-anchor">#</a> The Mapping File</h3> <p>This file is necessary to map the input FASTQ pairs from one or more sequencing lanes to sample names. Additionally, this file tells the pipeline whether the samples are exome or genome samples. In the case of the former, the capture kit used is also input.</p> <p>Example:</p> <table><thead><tr><th style="text-align:center;">SAMPLE</th> <th style="text-align:center;">LANE</th> <th style="text-align:center;">ASSAY</th> <th style="text-align:center;">TARGET</th> <th style="text-align:center;">FASTQ_PE1</th> <th style="text-align:center;">FASTQ_PE2</th></tr></thead> <tbody><tr><td style="text-align:center;">normal_sample_1</td> <td style="text-align:center;">L001</td> <td style="text-align:center;">wes</td> <td style="text-align:center;">agilent</td> <td style="text-align:center;">normal1_L001_R01.fastq.gz</td> <td style="text-align:center;">normal1_L001_R02.fastq.gz</td></tr> <tr><td style="text-align:center;">normal_sample_1</td> <td style="text-align:center;">L002</td> <td style="text-align:center;">wes</td> <td style="text-align:center;">agilent</td> <td style="text-align:center;">normal1_L002_R01.fastq.gz</td> <td style="text-align:center;">normal1_L002_R02.fastq.gz</td></tr> <tr><td style="text-align:center;">tumor_sample_1</td> <td style="text-align:center;">L001</td> <td style="text-align:center;">wes</td> <td style="text-align:center;">agilent</td> <td style="text-align:center;">tumor1_L001_R01.fastq.gz</td> <td style="text-align:center;">tumor1_L001_R02.fastq.gz</td></tr> <tr><td style="text-align:center;">tumor_sample_1</td> <td style="text-align:center;">...</td> <td style="text-align:center;">wes</td> <td style="text-align:center;">agilent</td> <td style="text-align:center;">...</td> <td style="text-align:center;">...</td></tr> <tr><td style="text-align:center;">tumor_sample_1</td> <td style="text-align:center;">L00N</td> <td style="text-align:center;">wes</td> <td style="text-align:center;">agilent</td> <td style="text-align:center;">tumor1_L00N_R01.fastq.gz</td> <td style="text-align:center;">tumor1_L00N_R02.fastq.gz</td></tr></tbody></table> <p>Accepted values for the <strong>ASSAY</strong> column are <code>exome</code> and <code>genome</code>.<br>
Accepted values for the <strong>TARGET</strong> column are <code>agilent</code> and <code>idt</code>.<br>
Read further details on these parameters <a href="/reference-resources.html#genomic-intervals">here</a>.</p> <h3 id="the-pairing-file"><a href="#the-pairing-file" aria-hidden="true" class="header-anchor">#</a> The Pairing File</h3> <p>The pipeline needs to know which tumor and normal samples are to be analyzed as matched pairs. This files provides that pairing by referring to the sample names as provided in the <strong>SAMPLE</strong> column in the mapping file.</p> <p>Example:</p> <table><thead><tr><th style="text-align:center;">NORMAL_ID</th> <th style="text-align:center;">TUMOR_ID</th></tr></thead> <tbody><tr><td style="text-align:center;">normal_sample_1</td> <td style="text-align:center;">tumor_sample_1</td></tr> <tr><td style="text-align:center;">normal_sample_2</td> <td style="text-align:center;">tumor_sample_2</td></tr> <tr><td style="text-align:center;">...</td> <td style="text-align:center;">...</td></tr> <tr><td style="text-align:center;">normal_sample_n</td> <td style="text-align:center;">tumor_sample_n</td></tr></tbody></table> <h2 id="running-with-input-bams"><a href="#running-with-input-bams" aria-hidden="true" class="header-anchor">#</a> Running with Input BAMs</h2> <p>If the user is processing input BAMs, a mapping of tumor and normal sample names to BAM files and their pairing is used as below, in lieu of providing separate mapping and pairing files as when starting from FASTQ files.</p> <div class="language-shell extra-class"><pre class="language-text"><code>nextflow run pipeline.nf --somatic --germline \
    --bam_pairing &lt;input bam TN pairs tsv file&gt; \
    -profile juno \
    --outDir results 
</code></pre></div><p>The <code>bam_pairing</code> input file is also a tab-separated file, see a further description below.</p> <h3 id="the-bam-pairing-file"><a href="#the-bam-pairing-file" aria-hidden="true" class="header-anchor">#</a> The BAM Pairing File</h3> <p>Given BAMs as inputs, the user must specify which tumor and normal samples are to be analyzed as matched pairs. The following format is used:</p> <p>Example:</p> <table><thead><tr><th style="text-align:center;">TUMOR_ID</th> <th style="text-align:center;">NORMAL_ID</th> <th style="text-align:center;">ASSAY</th> <th style="text-align:center;">TARGET</th> <th style="text-align:center;">TUMOR_BAM</th> <th style="text-align:center;">NORMAL_BAM</th></tr></thead> <tbody><tr><td style="text-align:center;">normal_sample_1</td> <td style="text-align:center;">tumor_sample_1</td> <td style="text-align:center;">wes</td> <td style="text-align:center;">agilent</td> <td style="text-align:center;">/path/to/file/tumor_1.bam</td> <td style="text-align:center;">/path/to/file/normal_1.bam</td></tr> <tr><td style="text-align:center;">normal_sample_2</td> <td style="text-align:center;">tumor_sample_2</td> <td style="text-align:center;">wes</td> <td style="text-align:center;">agilent</td> <td style="text-align:center;">/path/to/file/tumor_2.bam</td> <td style="text-align:center;">/path/to/file/normal_2.bam</td></tr> <tr><td style="text-align:center;">...</td> <td style="text-align:center;">...</td> <td style="text-align:center;">...</td> <td style="text-align:center;">...</td> <td style="text-align:center;">...</td> <td style="text-align:center;">...</td></tr> <tr><td style="text-align:center;">normal_sample_n</td> <td style="text-align:center;">tumor_sample_n</td> <td style="text-align:center;">wes</td> <td style="text-align:center;">agilent</td> <td style="text-align:center;">/path/to/file/tumor_n.bam</td> <td style="text-align:center;">/path/to/file/normal_n.bam</td></tr></tbody></table> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>The pipeline expects BAM file indices in the same subdirectories as <code>TUMOR_BAM</code> and <code>NORMAL_BAM</code>. If the index files <code>*.bai</code> do not exist, <code>pipeline.nf</code> will throw an error.</p></div> <h2 id="running-the-pipeline-on-juno"><a href="#running-the-pipeline-on-juno" aria-hidden="true" class="header-anchor">#</a> Running the Pipeline on Juno</h2> <h3 id="submitting-the-pipeline-to-lsf"><a href="#submitting-the-pipeline-to-lsf" aria-hidden="true" class="header-anchor">#</a> Submitting the Pipeline to LSF</h3> <p>We recommend submitting your <code>nextflow run pipeline.nf &lt;...&gt;</code> command to the cluster via <code>bsub</code>, which will launch a leader job from which individual processes are submitted as jobs to the cluster.</p> <div class="language- extra-class"><pre class="language-text"><code>bsub -W &lt;hh:mm&gt; -n 1 -R &quot;rusage[mem=&lt;requested memory&gt;]&quot; \
    -o &lt;LSF output file name&gt;.out -e &lt;LSF error file name&gt;.err \
    nextflow run pipeline.nf -profile juno &lt;...&gt; 
</code></pre></div><p>It is <strong>important</strong> that users use a recent version of singularity, as detailed in <a href="/juno-setup.html">Juno setup</a>.</p> <p>We recommend that users check the <a href="https://www.ibm.com/support/knowledgecenter/en/SSETD4_9.1.2/lsf_command_ref/bsub.1.html" target="_blank" rel="noopener noreferrer">documentation for LSF<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to clarify each of the arguments above. However,</p> <ul><li><code>-W &lt;hh:mm&gt;</code> sets the time allotted for <code>nextflow run pipeline.nf</code> to run to completion.</li> <li><code>-n 1</code> is requesting one slot. This should be sufficient for <code>nextflow run pipeline.nf</code></li> <li><code>-o &lt;LSF output file name&gt;.out</code> is the name of the STDOUT file, which is quite informative for Nextflow. We <strong>strongly</strong> encourage users to set this.</li> <li><code>-e &lt;LSF output file name&gt;.err</code> is the name of the STDERR file. Please set this.</li> <li><code>-R &quot;rusage[mem=&lt;requested memory&gt;]&quot;</code> is the requested memory for  <code>nextflow run pipeline.nf</code>, which will not be memory intensive at all.</li></ul> <p>Here is a concrete example of a bsub command to process 25 WES TN pairs, running somatic and germline variant calling modules:</p> <div class="language-shell extra-class"><pre class="language-text"><code>bsub -W 80:00 -n 1 -R &quot;rusage[mem=15]&quot; -o nf_output.out -e nf_output.err \
    nextflow run &lt;path-to-repository&gt;/pipeline.nf --somatic --germline \
    --mapping test_inputs/local/WES_25TN.tsv --pairing test_inputs/local/WES_25TN_pairing.tsv 
    --outDir results \
    -profile juno
</code></pre></div><h3 id="running-from-a-screen-session"><a href="#running-from-a-screen-session" aria-hidden="true" class="header-anchor">#</a> Running From a <code>screen</code> Session</h3> <p>Another option is to use a <code>screen</code> session for running the pipeline interactively, for example naming and entering a screen session as follows:</p> <p><code>screen -RD new_screen_name</code></p> <p>It is normally not a good idea to run things on the log-in nodes of the cluster. Instead we recommend scheduling an interactive session via e.g. <code>bsub -Is -n 1 -R &quot;rusage[mem=20]&quot; csh</code> and running the <code>screen</code> within that session.</p> <p>Users are welcome to use <code>nohup</code> or <code>tmux</code> as well.</p> <h2 id="running-the-pipeline-on-aws"><a href="#running-the-pipeline-on-aws" aria-hidden="true" class="header-anchor">#</a> Running the Pipeline on AWS</h2> <p>These instructions will assume the user is moderately knowledgeable of AWS. Please refer to <a href="/aws-setup.html">AWS Setup</a> and the <a href="/aws-glossary.html">AWS Glossary</a> we have curated.</p> <h2 id="modifying-or-resuming-pipeline-run"><a href="#modifying-or-resuming-pipeline-run" aria-hidden="true" class="header-anchor">#</a> Modifying or Resuming Pipeline Run</h2> <p>Nextflow supports <a href="https://www.nextflow.io/docs/latest/getstarted.html?#modify-and-resume" target="_blank" rel="noopener noreferrer">modify and resume<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>To resume an interrupted Nextflow pipeline run, add <code>-resume</code> (note the single dash) to your command-line call to access Nextflow's cache history and continue a job from where it left off. This will trigger a check of which jobs already completed before starting unfinished jobs in the pipeline.</p> <p>This function also allows you to make changes to values in the <code>pipeline.nf</code> script and continue from where you left off. Nextflow will use the cached information from the unchanged sections while running only the modified processes. If you want to make changes to processes that already successfully completed, you have to manually delete the subdirectories in <code>work</code> where those processes where run.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p> <ul><li>If you use <code>-resume</code> for the first time of a timeline run, Nextflow will recognize this as superfluous, and continue.</li> <li>To peacefully interrupt an ongoing Nextflow pipeline run, do <code>control+C</code> once and wait for Nextflow to kill submitted jobs. Otherwise orphan jobs might be left on the cluster.</li></ul></div> <h2 id="after-successful-run"><a href="#after-successful-run" aria-hidden="true" class="header-anchor">#</a> After Successful Run</h2> <p>Nextflow creates a lot of intermediate output files. All the relevant output data should be in the directory given to the <code>outDir</code> argument. Once you have verified that the data are satisfactory, everything outside this directory can be removed. In particular, the <code>work</code> directory will occupy a lot of space and should be removed. The <code>nextflow clean -force</code> command does all of this. Also see <code>nextflow clean -help</code> for options.</p> <div class="warning custom-block"><p class="custom-block-title">Be aware</p> <p>Once these files are removed, modifications to or resumption of a pipeline run <strong>cannot</strong> be done.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.98741281.js" defer></script><script src="/assets/js/2.e10afc37.js" defer></script><script src="/assets/js/16.8466b006.js" defer></script>
  </body>
</html>
