<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AWS Setup</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.d4613532.css" as="style"><link rel="preload" href="/assets/js/app.98741281.js" as="script"><link rel="preload" href="/assets/js/2.e10afc37.js" as="script"><link rel="preload" href="/assets/js/8.d5159c77.js" as="script"><link rel="prefetch" href="/assets/js/10.47a85e35.js"><link rel="prefetch" href="/assets/js/11.e78ae733.js"><link rel="prefetch" href="/assets/js/12.569b3204.js"><link rel="prefetch" href="/assets/js/13.4943b92b.js"><link rel="prefetch" href="/assets/js/14.c1aef2a4.js"><link rel="prefetch" href="/assets/js/15.88b928ad.js"><link rel="prefetch" href="/assets/js/16.8466b006.js"><link rel="prefetch" href="/assets/js/17.48c6fe4c.js"><link rel="prefetch" href="/assets/js/18.38a33712.js"><link rel="prefetch" href="/assets/js/19.b6fe101c.js"><link rel="prefetch" href="/assets/js/20.63f9a4f8.js"><link rel="prefetch" href="/assets/js/21.05021021.js"><link rel="prefetch" href="/assets/js/3.cd2560e0.js"><link rel="prefetch" href="/assets/js/4.1367f42d.js"><link rel="prefetch" href="/assets/js/5.70f8d865.js"><link rel="prefetch" href="/assets/js/6.a2a4a4fd.js"><link rel="prefetch" href="/assets/js/7.22b6c02c.js"><link rel="prefetch" href="/assets/js/9.40da1173.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4613532.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="aws-setup"><a href="#aws-setup" aria-hidden="true" class="header-anchor">#</a> AWS Setup</h1> <p><em>Note: These instructions assume the user has a moderate knowledge of AWS concepts, including S3 buckets, EC2 instances, AMIs, EBS volumes, AWS Batch, and autoscaling. For a succinct summary of these concepts, please check the <a href="/aws-glossary.html">AWS glossary</a>, the <a href="https://docs.aws.amazon.com/AmazonS3" target="_blank" rel="noopener noreferrer">AWS documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, and other recent AWS tutorials circa 2018.</em></p> <p>Building the compute environment for AWS Batch consist of two steps.</p> <div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>You need to first <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" target="_blank" rel="noopener noreferrer">install<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html" target="_blank" rel="noopener noreferrer">configure<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> AWS command-line interface (CLI).</p></div> <h2 id="creating-the-s3-bucket"><a href="#creating-the-s3-bucket" aria-hidden="true" class="header-anchor">#</a> Creating the S3 Bucket</h2> <p>You must first create an <code>S3 bucket</code> which will be used as working directory and where your outputs will be stored, as described <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/create-bucket.html" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Use <code>S3</code> bucket path for <code>&lt;AWS-S3-WORKDIR&gt;</code> value when creating <code>awsbatch.config</code>.</p> <h2 id="building-the-ami"><a href="#building-the-ami" aria-hidden="true" class="header-anchor">#</a> Building the AMI</h2> <p>Vaporware's Amazon Machine Image (AMI) is implemented with <a href="https://docs.opendata.aws/genomics-workflows/core-env/create-custom-compute-resources" target="_blank" rel="noopener noreferrer">EBS autoscaling script<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which will automatically increase disk space when needed.</p> <p>To prepare the AMI for your compute environment, run the command below from the Vaporware root directory.</p> <div class="language-shell extra-class"><pre class="language-text"><code>aws cloudformation create-stack \
    --stack-name vaporwareAMI \
    --template-body file://aws_cf_scripts/AMICreate.yaml \
    --parameters ParameterKey=AMIName,ParameterValue=vaporware-ami \
    --capabilities CAPABILITY_IAM
</code></pre></div><p><em>Note: You can specify any name instead of <code>vaporwareAMI</code> for stack-name.</em></p> <p>This command submits CloudFormation Stack for building the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html" target="_blank" rel="noopener noreferrer">AMI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for execution, which we will use for building Batch Compute Environment. When you submit the command you will get StackId ARN as a response similar to this below.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;StackId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:cloudformation:us-east-1:474622381158:stack/vaporwareAMI/f8d47a90-41c8-11e9-98cc-0eb85d5eff94&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Building the AMI will take a few minutes. You can check the status of the build process by running <code>aws cloudformation describe-stacks --stack-name vaporwareAMI</code>.</p> <p>When build is complete the <code>StackStatus</code> field in the response JSON will have the value <code>CREATE_COMPLETE</code> and the <code>Outputs</code> section will look similar to:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;Outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;OutputKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AMI&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;OutputValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ami-0599a84d7553f2fb7&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
</code></pre></div><p>We will use <code>OutputValue</code> for the next step.</p> <h2 id="building-the-compute-environment"><a href="#building-the-compute-environment" aria-hidden="true" class="header-anchor">#</a> Building the Compute Environment</h2> <p>Run the command below from the Vaporware repo root directory and set <code>&lt;AMI-ID&gt;</code> parameter to <code>OutputValue</code> from previous step. If you skipped previous section do not add the <code>--parameters</code> argument when running the command.</p> <div class="language-shell extra-class"><pre class="language-text"><code>aws cloudformation create-stack \
    --stack-name vaporwareAWSBatchCE \
    --template-body file://aws_cf_scripts/AWSBatchCreate.yaml \
    --capabilities CAPABILITY_IAM \
    --parameters ParameterKey=AmiId,ParameterValue=&lt;AMI-ID&gt;
</code></pre></div><p><em>Note: You can specify any name instead of <code>vaporwareAWSBatchCE</code> for stack-name.</em></p> <p>Building the AWS Batch Compute Environment will take a few minutes. You can check the status of the build process by running <code>aws cloudformation describe-stacks --stack-name vaporwareAWSBatchCE</code>.</p> <p>When build is complete the <code>StackStatus</code> field in response JSON will have the value <code>CREATE_COMPLETE</code> and the <code>Outputs</code> section will look similar to:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;Outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;OutputKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ComputeEnvironmentArn&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;OutputValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:batch:us-east-1:474622381158:compute-environment/ComputeEnvironment-c5b2c9926a6fb42&quot;</span>conf/awsbatch.config
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;OutputKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JobQueueArn&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;OutputValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:batch:us-east-1:474622381158:job-queue/JobQueue-f2090879374b5cc&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
</code></pre></div><p>Use <code>OutputValue</code> of <code>JobQueueArn</code> for <code>&lt;AWS-BATCH-QUEUE-ARN&gt;</code> value when creating <code>awsbatch.config</code>.</p> <h2 id="create-configuration-file"><a href="#create-configuration-file" aria-hidden="true" class="header-anchor">#</a> Create Configuration File</h2> <p>Create the <code>awsbatch.config</code> file in <code>conf</code> directory using <code>conf/awsbatch.config.template</code></p> <p>Replace the following values:</p> <ul><li><code>&lt;AWS-REGION&gt;</code> with aws region where you built your compute environment.</li> <li><code>&lt;STORAGE-ENCRYPTION&gt;</code> storage encryption for your bucket (default: 'AES256').</li> <li><code>&lt;AWS-BATCH-QUEUE-ARN&gt;</code> ARN of your AWS Batch Job Queue built in <a href="#Building-the-Compute-Environment">Building the Compute Environment</a> section.</li> <li><code>&lt;AWS-S3-WORKDIR&gt;</code> S3 bucket used as working directory created in <a href="#Create-the-S3-Bucket">Create the S3 Bucket</a> section.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.98741281.js" defer></script><script src="/assets/js/2.e10afc37.js" defer></script><script src="/assets/js/8.d5159c77.js" defer></script>
  </body>
</html>
