/*
 * -------------------------------------------------
 * Nextflow config
 * -------------------------------------------------
 * Images for every process
 * "docker://" prefix for singularity obsolete in newer NF versions
 * -------------------------------------------------
 */

 process {
  withName:FastP {
    cpus = { 2 }
    memory = { 2.GB }
    queue = {params.queue_small}
  }
  withName:AlignReads {
    cpus = { 8 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:SortBAM {
    cpus = { 8 }
    memory = { 64.GB }
    queue = {params.queue_mem_optimized}
  }
  withName:MergeBams {
    cpus = { 8 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:MarkDuplicates { 
    // Actually the -Xmx value should be kept lower,
    // and is set through the markdup_java_options; cf https://github.com/SciLifeLab/Sarek/blob/master/conf/resources.config#L31
    cpus = { 8 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:CreateRecalibrationTable {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:RecalibrateBam {
    cpus = { 4 }
    memory = { 4.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:Alfred {
    cpus = { 1 }
    memory = { 2.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:CreateScatteredIntervals {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }

//------------- Somatic Pipeline

  withName:SomaticDellyCall {
    cpus = { 1 }
    memory = { 4.GB }
    queue = {params.queue_mem_optimized}
  }
  withName:SomaticDellyFilter {
    cpus = { 1 }
    memory = { 4.GB }
    queue = {params.queue_mem_optimized}
  }
  withName:RunMutect2 {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:RunMutect2Filter {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:SomaticCombineMutect2Vcf {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:SomaticRunManta {
    cpus = { 8 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:SomaticRunStrelka2{
    cpus = { 8 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:SomaticMergeStrelka2Vcfs {
    cpus = { 1 }
    memory = { 1.GB }
    queue = {params.queue_small}
  }
  withName:MergeStrelka2Vcfs {
    cpus = { 8 }
    memory = { 32.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:SomaticRunVcf2Maf {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:DoSnpPileup {
    cpus = { 1 }
    memory = { 1.GB }
    queue = {params.queue_small}
  }
  withName:DoFacets {
    cpus = { 8 }
    memory = { 32.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:CombineHaplotypecallerVcf {
    cpus = { 8 }
    memory = { 32.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:RunMsiSensor {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:RunHlaPolysolver {
    cpus = { 4 }
    memory = { 4.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:RunConpair {
    cpus = { 4 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }

//------------- Germline Pipeline

  withName:GermlineDellyCall {
    cpus = { 1 }
    memory = { 4.GB }
    queue = {params.queue_mem_optimized}
  }
  withName:GermlineDellyFilter {
    cpus = { 1 }
    memory = { 4.GB }
    queue = {params.queue_mem_optimized}
  }
  withName:GermlineRunHaplotypecaller { 
    cpus = { 8 }
    memory = { 32.GB }
    queue = {params.queue_cpu_optimized}
  withName:GermlineCombineHaplotypecallerVcf {
    cpus = { 2 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:GermlineRunManta {
    cpus = { 8 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:GermlineRunStrelka2 {
    cpus = { 8 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:GermlineCombineChannel {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:GermlineRunVcf2Maf {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:GermlineMergeDellyAndManta {
    cpus = { 2 }
    memory = { 8.GB }
    queue = {params.queue_cpu_optimized}
  }
  withName:GermlineRunBcfToolsFilterOnDellyManta {
    cpus = { 4 }
    memory = { 16.GB }
    queue = {params.queue_cpu_optimized}
  }
}
